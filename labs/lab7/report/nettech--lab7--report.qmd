---
# Preamble

## Author
author:
  name: Калашникова Ольга Сергеевна
  email: 1132231846@rudn.ru
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 117198
      city: Москва
      address: ул. Миклухо-Маклая, д. 6
## Title
title: "Отчёт по лабораторной работе №7"
subtitle: "Дисциплина: Сетевые технологии"
license: "CC BY"
## Generic options
lang: ru-RU
number-sections: true
toc: true
toc-title: "Содержание"
toc-depth: 2
## Crossref customization
crossref:
  lof-title: "Список иллюстраций"
  lot-title: "Список таблиц"
  lol-title: "Листинги"
## Bibliography
bibliography:
  - bib/cite.bib
csl: _resources/csl/gost-r-7-0-5-2008-numeric.csl
## Formats
format:
### Pdf output format
  pdf:
    toc: true
    number-sections: true
    colorlinks: false
    toc-depth: 2
    lof: true # List of figures
    lot: true # List of tables
#### Document
    documentclass: scrreprt
    papersize: a4
    fontsize: 12pt
    linestretch: 1.5
#### Language
    babel-lang: ru
    babel-otherlangs: en
#### Biblatex
    cite-method: biblatex
    biblio-style: gost-numeric
    biblatexoptions:
      - backend=biber
      - langhook=extras
      - autolang=other*
#### Misc options
    csquotes: true
    indent: true
    header-includes: |
      \usepackage{indentfirst}
      \usepackage{float}
      \floatplacement{figure}{H}
      \usepackage[math,RM={Scale=0.94},SS={Scale=0.94},SScon={Scale=0.94},TT={Scale=MatchLowercase,FakeStretch=0.9},DefaultFeatures={Ligatures=Common}]{plex-otf}
### Docx output format
  docx:
    toc: true
    number-sections: true
    toc-depth: 2
---

# Цель работы

Получение навыков настройки службы DHCP на сетевом оборудовании для распределения адресов IPv4 и IPv6.

# Задание

1. Требуется настроить на маршрутизаторе, имеющим адрес 10.0.0.1, DHCP-
сервис по распределению IPv4-адресов из диапазона 10.0.0.2 – 10.0.0.253, на-
строить получение адреса по DHCP на узле (PC), а также исследовать пакеты
DHCP.

2. на интерфейсе марштрутизатора eth1 настроить DHCPv6 без отслеживания
состояния;

3. на интерфейсе марштрутизатора eth2 настроить DHCPv6 с учётом отслежи-
вания состояния.

# Выполнение лабораторной работы

## Настройка DHCP в случае IPv4

В GNS3 был создан проект согласно топологии. Были размещены и соединены устройства: маршрутизатор VyOS и клиент VPCS. Названия устройств были изменены в соответствии с требованиями ([рис. @fig-001]).

![Топология проекта в GNS3](image/1.png){#fig-001 width=70%}

Была произведена установка системы на маршрутизатор (уже было установлено) ([рис. @fig-002]).

![Ошибка установки в установленной системе](image/2.png){#fig-002 width=70%}

Затем была выполнена базовая настройка маршрутизатора: задано имя устройства `oskalashnikova-gw-01` и доменное имя `oskalashnikova.net`, создан пользователь `oskalashnikova` с паролем `123456`, удалён пользователь по умолчанию `vyos` ([рис. @fig-003]).

![Настройка базовых параметров VyOS](image/3.png){#fig-003 width=70%}

Был настроен интерфейс `eth0` с IPv4-адресом `10.0.0.1/24` ([рис. @fig-004]).

![Настройка адреса на интерфейсе eth0](image/4.png){#fig-004 width=70%}

Далее добавлена конфигурация DHCP-сервера: создана разделяемая сеть `oskalashnikova` с подсетью `10.0.0.0/24`, указан диапазон адресов `10.0.0.2–10.0.0.253`, заданы шлюз по умолчанию `10.0.0.1`, DNS-сервер `10.0.0.1` и доменное имя `oskalashnikova.net`. При первоначальной попытке коммита возникла ошибка из-за конфликта статического и DHCP-адреса на интерфейсе `eth0`, которая была исправлена удалением настройки DHCP с интерфейса ([рис. @fig-005]).

![Настройка DHCP-сервера на маршрутизаторе](image/5.png){#fig-005 width=70%}

После настройки была проверена статистика DHCP-сервера. На момент проверки выданных адресов не было ([рис. @fig-006]).

![Статистика DHCP-сервера до выдачи адресов](image/6.png){#fig-006 width=70%}

На клиенте `VPCS` была выполнена команда `ip dhcp -d` для получения адреса по DHCP с отображением процесса. ([рис. @fig-007]).

![Процесс получения адреса по DHCP на VPCS](image/7.png){#fig-007 width=70%}

Продолжение ([рис. @fig-008]).

![Процесс получения адреса по DHCP на VPCS](image/8.png){#fig-008 width=70%}

 Устройство автоматически получило полную конфигурацию сети от DHCP-сервера 10.0.0.1. Были назначены IP-адрес 10.0.0.2 с маской /24, шлюз по умолчанию 10.0.0.1 и DNS-сервер 10.0.0.1. Это свидетельствует о корректной работе службы DHCP, обеспечивающей автоматизацию начальной настройки сетевых параметров.

После успешного получения адреса была проверена конфигурация IP на клиенте. Клиент получил адрес `10.0.0.2/24`, шлюз `10.0.0.1`, DNS-сервер `10.0.0.1` и доменное имя `oskalashnikova.net`. Выполнен успешный пинг шлюза `10.0.0.1` ([рис. @fig-009]).

![Проверка IP-конфигурации и ping на VPCS](image/9.png){#fig-009 width=70%}

После получения адреса клиентом была повторно проверена статистика DHCP-сервера. Видно, что был выдан один адрес (`10.0.0.2`) для клиента с MAC-адресом `00:50:79:66:68:00` и именем `VPCS`. Время аренды составляет 86400 секунд ([рис. @fig-010]).

![Статистика и список аренд DHCP после выдачи адреса](image/10.png){#fig-010 width=70%}

Также была проверена системная информация по логам DHCP командой `show log | grep dhcp` ([рис. @fig-011]).

![Логи DHCP-сервера](image/11.png){#fig-011 width=70%}

Был произведён захват и анализ трафика между устройствами. На снимке видны многочисленные кадры, включая широковещательные DHCP-запросы и ответы, а также IPv6-мультикаст-адреса и широковещательный адрес `255.255.255.255` ([рис. @fig-012]).

![Анализ захваченных пакетов DHCP](image/12.png){#fig-012 width=70%}

Пояснение: два последовательных сообщения — «DHCP Discover» и «DHCP Offer» — отражают начальный этап автоматического получения IP-адреса клиентом PC1. Сначала клиент отправил широковещательный запрос (Discover) в сеть, чтобы обнаружить доступные DHCP-серверы. В ответ сервер предложил (Offer) конкретный IP-адрес из настроенного пула. Таким образом, устройству была обеспечена возможность автоматической сетевой настройки без ручного ввода параметров.
Сервер отвечает DHCP ACK, завершая процесс аренды IP-адреса 10.0.0.2. Присутствующие в захвате ARP-запросы (Who has 10.0.0.2) показывают проверку уникальности адреса в сети перед его окончательным назначением. Все сообщения имеют одинаковый транзакционный идентификатор (0x75d6133), что подтверждает их принадлежность одной сессии DHCP.

## Настройка DHCP в случае IPv6

Была дополнена топология сети в проекте GNS3: добавлены коммутаторы `oskalashnikova-sw-02`, `oskalashnikova-sw-03` и клиенты `PC2-oskalashnikova`, `PC3-oskalashnikova` на базе Kali Linux (Alpine не работает) ([рис. @fig-013]).

![Дополненная топология сети](image/13.png){#fig-013 width=70%}

На маршрутизаторе `oskalashnikova-gw-01` были настроены IPv6-адреса на интерфейсах `eth1` (`2000::1/64`) и `eth2` (`2001::1/64`) ([рис. @fig-014]).

![Настройка IPv6-адресов на маршрутизаторе](image/14.png){#fig-014 width=70%}

Для сегмента сети `2000::/64` (интерфейс `eth1`) была выполнена настройка DHCPv6 без отслеживания состояния (Stateless). Настроены объявления маршрутизатора (Router Advertisements) с префиксом `2000::/64` и флагом `other-config-flag`, указывающим на использование DHCPv6 для получения дополнительных параметров. Создана разделяемая сеть DHCPv6 `oskalashnikova-stateless` с указанием DNS-сервера `2000::1` и домена `oskalashnikova.net` ([рис. @fig-015], [рис. @fig-016]).

![Настройка RA и флага для Stateless DHCPv6](image/15.png){#fig-015 width=70%}

![Конфигурация Stateless DHCPv6 сервера](image/16.png){#fig-016 width=70%}

На клиенте `PC2-oskalashnikova` проверена сетевая конфигурация. Устройство получило IPv6-адрес `2000::42:f9ff:fe90:bd00/64` через механизм SLAAC, а также маршрут по умолчанию через `fe80::eec:c2ff:fe23:1` (link-адрес маршрутизатора) ([рис. @fig-017]).

![Сетевая конфигурация PC2 до получения DHCPv6 параметров](image/17.png){#fig-017 width=70%}

Для проверки связи потребовалось создать символические ссылки на утилиты из busybox. После этого выполнен успешный ping до маршрутизатора `2000::1` ([рис. @fig-018]).

![Настройка busybox и ping до маршрутизатора с PC2](image/18.png){#fig-018 width=70%}

Файл `/etc/resolv.conf` изначально был пустым, что указывает на отсутствие настроенных DNS-серверов ([рис. @fig-019]).

![Проверка /etc/resolv.conf на PC2 до DHCPv6](image/19.png){#fig-019 width=70%}

Запущен процесс получения конфигурационных параметров через Stateless DHCPv6 командой `dhclient -6 -S -v eth0`. Процесс завершился успешно, клиент получил ответ от сервера с адреса `fe80::ece:c2ff:fe23:1` ([рис. @fig-020]).

![Получение параметров через Stateless DHCPv6 на PC2](image/20.png){#fig-020 width=70%}

После получения параметров DHCPv6 связь с маршрутизатором осталась работоспособной ([рис. @fig-021]).

![Ping до маршрутизатора после DHCPv6 на PC2](image/21.png){#fig-021 width=70%}

Проверка файла `/etc/resolv.conf` показала, что теперь в нём прописан DNS-сервер `2000::1` и домен поиска `oskalashnikova.net`, что подтверждает успешную работу Stateless DHCPv6 ([рис. @fig-022]).

![Проверка /etc/resolv.conf на PC2 после DHCPv6](image/22.png){#fig-022 width=70%}

Проверка списка аренд (leases) на DHCPv6 сервере показала отсутствие выданных IPv6-адресов, что соответствует принципу Stateless (без отслеживания состояния), при котором сервер раздаёт только параметры конфигурации, а не адреса ([рис. @fig-023]).

![Проверка списка аренд DHCPv6 сервера для Stateless](image/23.png){#fig-023 width=70%}

Был произведён захват трафика на интерфейсе, анализирующий процесс работы DHCPv6 и SLAAC. ([рис. @fig-024]).

![Захват трафика DHCPv6/SLAAC](image/24.png){#fig-024 width=70%}

Поскольку на сегменте сети 2000::/64 настроен режим DHCPv6 без отслеживания состояния (Stateless), сервер не назначает клиентам конкретные IPv6‑адреса. Вместо этого адреса формируются автоматически самими клиентами с помощью механизма SLAAC на основе полученного префикса. В этом режиме DHCPv6‑сервер передаёт только дополнительные параметры конфигурации (DNS, доменное имя), что и объясняет отсутствие в пакете информации о выделенном адресе PC2, а также отсутствие активных записей в таблице аренд (leases) сервера.

Для сегмента сети `2001::/64` (интерфейс `eth2`) была выполнена настройка DHCPv6 с отслеживанием состояния (Stateful). Настроен флаг `managed-flag` в объявлениях маршрутизатора, указывающий устройствам на необходимость получения адреса через управляемый протокол (DHCPv6) ([рис. @fig-025]).

![Настройка managed-flag для Stateful DHCPv6](image/25.png){#fig-025 width=70%}

Создана разделяемая сеть DHCPv6 `oskalashnikova-stateful` с подсетью `2001::/64`. Задан диапазон выдаваемых адресов `2001::100 – 2001::199`, а также параметры DNS-сервера (`2001::1`) и домена поиска ([рис. @fig-026]).

![Конфигурация Stateful DHCPv6 сервера](image/26.png){#fig-026 width=70%}

Проверка списка аренд на сервере до начала выдачи адресов показала пустой результат ([рис. @fig-027]).

![Проверка списка аренд DHCPv6 сервера до выдачи адресов](image/27.png){#fig-027 width=70%}

На клиенте `PC3-oskalashnikova` проверена сетевая конфигурация. Устройство имеет только link-local адреса (`fe80::...`). Маршрут по умолчанию указывает на link-адрес маршрутизатора `fe80::ece:c2ff:fe23:2` ([рис. @fig-028]).

![Сетевая конфигурация PC3 до получения адреса](image/28.png){#fig-028 width=70%}

Файл `/etc/resolv.conf` пустой ([рис. @fig-029]).

![Проверка /etc/resolv.conf на PC3 до DHCPv6](image/29.png){#fig-029 width=70%}

Запущен процесс получения IPv6-адреса и параметров через Stateful DHCPv6 командой `dhclient -6 -S -v eth0`. Процесс завершился успешно ([рис. @fig-030]).

![Получение адреса через Stateful DHCPv6 на PC3](image/30.png){#fig-030 width=70%}

После получения адреса сетевая конфигурация PC3 не изменилась в отображении команды `ip address`, так как для глобального адреса, выданного DHCPv6, может потребоваться дополнительная проверка ([рис. @fig-031]).

![Проверка сетевой конфигурации PC3 после DHCPv6](image/31.png){#fig-031 width=70%}

Тем не менее, связь с маршрутизатором `2001::1` была успешно установлена, что подтверждает работоспособность сети и корректность получения маршрута ([рис. @fig-032]).

![Ping до маршрутизатора 2001::1 с PC3](image/32.png){#fig-032 width=70%}

Для получения полноценного IPv6-адреса от Stateful DHCPv6 сервера была выполнена команда `dhclient -6 -v eth0`. В ходе процесса виден обмен сообщениями Solicit и Advertise. Сервер предложил (`Advertise`) клиенту адрес `2001::199` с временем жизни 43200 секунд ([рис. @fig-033]).

![Получение IPv6-адреса через Stateful DHCPv6 (Solicit/Advertise)](image/33.png){#fig-033 width=70%}

После завершения процесса `dhclient` проверка сетевой конфигурации на `PC3` показала, что устройству успешно назначен глобальный IPv6-адрес `2001::199/128`, выданный DHCPv6-сервером. В таблице маршрутизации появился маршрут для этой сети ([рис. @fig-034]).

![Сетевая конфигурация PC3 после получения IPv6-адреса](image/34.png){#fig-034 width=70%}

Связь с маршрутизатором `2001::1` осталась работоспособной ([рис. @fig-035]).

![Ping до маршрутизатора 2001::1 после получения адреса](image/35.png){#fig-035 width=70%}

Проверка файла `/etc/resolv.conf` подтвердила, что клиент также получил от DHCPv6 сервера параметры DNS: сервер `2001::1` и домен поиска `oskalashnikova.net` ([рис. @fig-036]).

![Проверка /etc/resolv.conf на PC3 после Stateful DHCPv6](image/36.png){#fig-036 width=70%}

Итоговая проверка списка аренд (leases) на DHCPv6 сервере показала наличие активной аренды для адреса `2001::199`, выданного клиенту с DUID `00:d7:e5:35:00:01:00:01:30:d6:...` в пуле `oskalashnikova-stateful`. Это подтверждает работу DHCPv6 в режиме с отслеживанием состояния ([рис. @fig-037]).

![Список аренд DHCPv6 сервера после выдачи адреса PC3](image/37.png){#fig-037 width=70%}

Был произведён захват трафика. Используется DHCPv6 с отслеживанием состояния, в пакете содержится
информация об IPv6 адресе узла PC3 ([рис. @fig-038]).

![Захват трафика Stateful DHCPv6](image/38.png){#fig-038 width=70%}

# Выводы

В ходе выполнения лабораторноф работы были получены навыки настройки службы DHCP на сетевом оборудовании для распределения адресов IPv4 и IPv6.
